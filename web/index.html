<!DOCTYPE HTML>
<html>
<head id="hed">
	<title>thrown-away</title>
	<script src="../../src/brython.js"></script>
	
</head>
<body onLoad="brython()">
	<h1>thrown-away</h1>
	<form>
		<ul id="input_list">
			<li><input type="text" name="name" id="name" placeholder="usr"/></li>
			<li><input type="text" name="name" id="name" placeholder="usr"/></li>
			<li><input type="text" name="name" id="name" placeholder="usr"/></li>
		</ul>
		<input type="button" value="add row" onclick="add_row()"/>
		<input type="button" value="submit" onclick="main()"/>
		<input type="button" value="process" onclick="process()"/>
		<input type="button" value="populate" onclick="populate()"/>
	</form>
	<div id="output">
	</div>
	
	<script type="text/python">
		def main():
			usernames = get_usernames()
			print(usernames)
			for user in usernames:
				add_tag(user)

		def add_row():
			list_str = '<li><input type="text" name="name" id="name" placeholder="usr"/></li>'
			doc['input_list'].html += list_str

		def get_usernames():
			usernames = []
			inputs = doc.get(name="name")
			for input in inputs:
				if input.value == '':
					continue
				else:
					usernames.append(input.value)
			return usernames

		def process():
			total_link = 0
			total_comment = 0

			data = JSObject(req)
			users = [usr for usr in dict(data)]
			for user in users:
				obj = JSObject(dict(data)[user]).data
				link = obj.link_karma
				comment = obj.comment_karma
				total_link += link
				total_comment += comment

			print(total_comment)
			print(total_link)
			#return total_link, total_comment
			output(total_link, total_comment)

		def output(total_link, total_comment):
			doc['output'].html += "<p>" + str(total_link) + "</p>"
			doc['output'].html += "<p>" + str(total_comment) + "</p>"

		def populate(): # for debugging
			doc.get(name="name")[0].value = "mmosskicker"
			doc.get(name="name")[1].value = "yten"
			doc.get(name="name")[2].value = "mepper"

	</script>
	<script type="text/javascript" charset="utf-8">
		var req = {};

		// super hacky getter function so brython can access json
		function callback(reddit_data){
			console.log(reddit_data.data.name);
			var name = reddit_data.data.name;
			req[name] = reddit_data;
			console.log(req);
		}

		function add_tag(user){
			var head= document.getElementsByTagName('head')[0];
	    	var script= document.createElement('script');
	    	script.type= 'text/javascript';
	    	script.src= 'http://www.reddit.com/user/' + user + '/about.json?jsonp=callback';
	    	head.appendChild(script);
	    }

	</script>

	<!-- <script src="http://www.reddit.com/user/mmosskicker/about.json?jsonp=callback"></script> -->
</body>
</html>
